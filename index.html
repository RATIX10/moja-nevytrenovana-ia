<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <title>AI Vision Trainer - Vidím a učím sa</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/knn-classifier"></script>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; height: 100vh; }
        header { padding: 20px; text-align: center; background: #252525; border-bottom: 3px solid #4A90E2; }
        .main-container { display: flex; flex: 1; padding: 20px; gap: 20px; }
        
        /* Video okno */
        #video-container { flex: 2; position: relative; background: black; border-radius: 15px; overflow: hidden; display: flex; justify-content: center; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        
        /* Ovládací panel */
        #controls { flex: 1; background: #2d2d2d; padding: 20px; border-radius: 15px; display: flex; flex-direction: column; gap: 15px; }
        .class-btn { padding: 15px; font-size: 1.1em; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .btn-blue { background: #4A90E2; color: white; }
        .btn-red { background: #e74c3c; color: white; }
        .btn-green { background: #2ecc71; color: white; }
        
        #prediction { font-size: 2em; text-align: center; color: #f1c40f; margin-top: 20px; padding: 10px; border: 2px dashed #f1c40f; border-radius: 10px; }
        .status { color: #888; font-size: 0.9em; text-align: center; }
    </style>
</head>
<body>

<header>
    <h1>AI VISION: Nauč ma, čo vidím</h1>
    <div class="status" id="status">Načítavam mozog AI...</div>
</header>

<div class="main-container">
    <div id="video-container">
        <video autoplay playsinline muted id="webcam"></video>
    </div>

    <div id="controls">
        <h3>1. Ukáž objekt na kameru</h3>
        <h3>2. Drž tlačidlo pre tréning:</h3>
        
        <button class="class-btn btn-blue" onmousedown="addExample(0)" onmouseup="stopTraining()">NAUČ: Objekt A (napr. Mobil)</button>
        <button class="class-btn btn-red" onmousedown="addExample(1)" onmouseup="stopTraining()">NAUČ: Objekt B (napr. Ruka)</button>
        <button class="class-btn btn-green" onmousedown="addExample(2)" onmouseup="stopTraining()">NAUČ: Pozadie (Nič)</button>

        <div id="prediction">Čakám na dáta...</div>
        <p class="status">Čím viac fotiek pridáš (držaním tlačidla), tým bude AI múdrejšia.</p>
    </div>
</div>

<script>
    const webcamElement = document.getElementById('webcam');
    const classifier = knnClassifier.create();
    let net;

    async function setupWebcam() {
        return new Promise((resolve, reject) => {
            const navigatorAny = navigator;
            navigator.getUserMedia = navigator.getUserMedia || navigatorAny.webkitGetUserMedia || navigatorAny.mozGetUserMedia || navigatorAny.msGetUserMedia;
            if (navigator.getUserMedia) {
                navigator.getUserMedia({video: true},
                    stream => { webcamElement.srcObject = stream; webcamElement.addEventListener('loadeddata', () => resolve(), false); },
                    error => reject());
            } else { reject(); }
        });
    }

    async function app() {
        document.getElementById('status').innerText = "Načítavam MobileNet (oči AI)...";
        net = await tf.loadLayersModel('https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json');
        document.getElementById('status').innerText = "Kamera aktívna. Môžeš začať trénovať!";

        await setupWebcam();

        while (true) {
            if (classifier.getNumClasses() > 0) {
                const img = await getImage();
                const activation = net.predict(img);
                const result = await classifier.predictClass(activation);

                const classes = ['Objekt A', 'Objekt B', 'Pozadie'];
                document.getElementById('prediction').innerText = classes[result.label];
                
                img.dispose();
            }
            await tf.nextFrame();
        }
    }

    async function getImage() {
        const img = await tf.browser.fromPixels(webcamElement);
        const centerHeight = img.shape[0] / 2;
        const beginHeight = centerHeight - (224 / 2);
        const centerWidth = img.shape[1] / 2;
        const beginWidth = centerWidth - (224 / 2);
        return img.slice([beginHeight, beginWidth, 0], [224, 224, 3]).expandDims(0).toFloat().div(tf.scalar(127)).sub(tf.scalar(1));
    }

    let training = false;
    async function addExample(classId) {
        training = true;
        while(training) {
            const img = await getImage();
            const activation = net.predict(img);
            classifier.addExample(activation, classId);
            img.dispose();
            await tf.nextFrame();
        }
    }

    function stopTraining() {
        training = false;
    }

    app();
</script>

</body>
</html>
